<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Velocity Change · SeisNoise.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../index.html"><img class="logo" src="../assets/logo.png" alt="SeisNoise.jl logo"/></a><h1>SeisNoise.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><span class="toctext">Types</span><ul><li><a class="toctext" href="../Types/fftdata/">FFTData</a></li><li><a class="toctext" href="../Types/corrdata/">CorrData</a></li></ul></li><li><a class="toctext" href="../preprocessing/">Pre-Processing</a></li><li><a class="toctext" href="../filter/">Filtering</a></li><li><a class="toctext" href="../fft/">Computing FFTs</a></li><li><a class="toctext" href="../correlation/">Correlation</a></li><li class="current"><a class="toctext" href>Velocity Change</a><ul class="internal"></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Velocity Change</a></li></ul><a class="edit-page" href="https://github.com/tclements/SeisNoise.jl/blob/master/docs/src/postprocessing.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Velocity Change</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Post-Processing-methods-for-working-with-correlation-data.-1" href="#Post-Processing-methods-for-working-with-correlation-data.-1"><code>Post-Processing</code> - methods for working with correlation data.</a></h1><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SeisNoise.mwcs" href="#SeisNoise.mwcs"><code>SeisNoise.mwcs</code></a> — <span class="docstring-category">Function</span>.</div><div><div><p>mwcs(ref, cur, fmin, fmax, fs, tmin, window<em>length, window</em>step,        smoothing<em>half</em>win)</p><p>Change in velocity measurement using the Moving Window Cross-Spectrum technique.</p><p>The current correlation <code>cur</code> is compared to the reference correlation <code>ref</code>. Both time series are sliced in several overlapping windows. Each slice is mean-adjusted and cosine-tapered (85% taper) before being Fourier- transformed to the frequency domain. <span>$F_{cur}(ν)$</span> and <span>$F_{ref}(ν)$</span> are the first halves of the Hermitian symmetric Fourier-transformed segments. The cross-spectrum <span>$X(ν)$</span> is defined as <span>$X(ν) = F_{ref}(ν) F_{cur}^*(ν)$</span> in which <span>${}^*$</span> denotes the complex conjugation. <span>$X(ν)$</span> is then smoothed by convolution with a Hanning window. The similarity of the two time-series is assessed using the cross-coherency between energy densities in the frequency domain: <span>$C(ν) = \frac{|\overline{X(ν))}|}{\sqrt{|\overline{F_{ref}(ν)|^2} |\overline{F_{cur}(ν)|^2}}}$</span> in which the over-line here represents the smoothing of the energy spectra for <span>$F_{ref}$</span> and <span>$F_{cur}$</span> and of the spectrum of <span>$X$</span>. The mean coherence for the segment is defined as the mean of <span>$C(ν)$</span> in the frequency range of interest. The time-delay between the two cross correlations is found in the unwrapped phase, <span>$ϕ(ν)$</span>, of the cross spectrum and is linearly proportional to frequency: <span>$ϕ_j = m. ν_j, m = 2 π δ t$</span> The time shift for each window between two signals is the slope <span>$m$</span> of a weighted linear regression of the samples within the frequency band of interest. The weights are those introduced by [Clarke2011]<em>, which incorporate both the cross-spectral amplitude and cross-coherence, unlike [Poupinet1984]</em>. The errors are estimated using the weights (thus the coherence) and the squared misfit to the modelled slope: <span>$e_m = \sqrt{\sum_j{(\frac{w_j ν_j}{\sum_i{w_i ν_i^2}})^2}σ_{ϕ}^2}$</span> where <span>$w$</span> are weights, <span>$ν$</span> are cross-coherences and <span>$σ_{ϕ}^2$</span> is the squared misfit of the data to the modelled slope and is calculated as <span>$σ_{ϕ}^2 = \frac{\sum_j(ϕ_j - m ν_j)^2}{N-1}$</span> The output of this process is a table containing, for each moving window: the central time lag, the measured delay, its error and the mean coherence of the segment.</p><p><strong>Arguments</strong></p><ul><li><code>ref::AbstractArray</code>: Reference correlation.</li><li><code>cur::AbstractArray</code>: Current correlation.</li><li><code>fmin:Float64</code>: minimum frequency in the correlation [Hz]</li><li><code>fmax:Float64</code>: maximum frequency in the correlation [Hz]</li><li><code>fs:Float64</code>: Sampling rate of <code>ref</code> and <code>cur</code> [Hz]</li><li><code>tmin:Float64</code>: The leftmost time lag [s]</li><li><code>window_len:Float64</code>: The moving window length [s]</li><li><code>window_step:Float64</code>: The step to jump for the moving window [s]</li><li><code>smoothing_half_win:Int</code>: Defines the half length of the smoothing hanning                           window.</li></ul><p><strong>Returns</strong></p><ul><li><code>time_axis:Array{Float64,1}</code>: Central time of each moving window [s]</li><li><code>dt:Array{Float64,1}</code>: dt for each moving window</li><li><code>err:Array{Float64,1}</code>: Errors for each moving window</li><li><code>mcoh:Array{Float64,1}</code>: Mean coherence for each moving window</li></ul><p>This code is a Julia translation of the Python code from <a href="https://github.com/ROBelgium/MSNoise/blob/master/msnoise/move2obspy.py">MSNoise</a>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tclements/SeisNoise.jl/blob/de310856964e0c472c21c2e5fa0e5956bce295b9/src/VelocityChange/MWCS.jl#L11-L71">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SeisNoise.mwcs_dvv" href="#SeisNoise.mwcs_dvv"><code>SeisNoise.mwcs_dvv</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">mwcs_dvv(time_axis,dt,err,coh,dtt_lag,dist,dtt_v,dtt_minlag,dtt_width,
         dtt_sides,min_coh, max_err, max_dt)</code></pre><p>Regresses dv/v from dt/t measurements.</p><p>Solves dt = a + bt, where b = dv/v, a = instrumental drift, dt = time lag at time t. Solves with a weighted linear regression with weights equal to 1/error**2.</p><p><strong>Arguments</strong></p><ul><li><code>time_axis:Array{Float64,1}</code>: Central time of each moving window [s]</li><li><code>dt:Array{Float64,1}</code>: dt for each moving window</li><li><code>err:Array{Float64,1}</code>: Errors for each moving window</li><li><code>coh:Array{Float64,1}</code>: Mean coherence for each moving window</li><li><code>dist:Float64</code>: Distance between stations [km]</li><li><code>dtt_lag:String</code>: Type of time lag &#39;dynamic&#39; or &#39;static&#39;. When <code>dtt_lag</code>   is set to &quot;dynamic&quot;, the inter-station distance is used to determine   the minimum time lag</li><li><code>dtt_v:Float64</code>: Velocity for minumum time lag. The velocity is determined by   the user so that the minlag doesn&#39;t include the ballistic waves.   If ballistic waves are visible with a velocity of 2 km/s, one could   configure dtt_v=1.0. If stations are located 15 km apart, the minimum   lag time will be set to 15 s.</li><li><code>minlag:Float64</code>: Statically set minimum lag [s]</li><li><code>dtt_width:Float64</code>: Width of the lag window used [s] i.e., if   dtt<em>width = 30, and min</em>lag = 15, window = 15s - 45s</li><li><code>dtt_sides:String</code>: Sides of cross-correlation function to use. Either   &#39;Both&#39; or &#39;left&#39;.</li><li><code>min_coh:Float64</code>: Minimum allowed coherency between reference and current                    correlation</li><li><code>max_err:Float64</code>: Maximum allowed error in dt/t regression</li><li><code>max_dt:Float64</code>: Maximum allowed dt from MWCS [s]</li></ul><p><strong>Returns</strong></p><ul><li><code>m::Float64</code>: dt/t for current correlation</li><li><code>em::Float64</code>: Error for calulatoin of <code>m</code></li><li><code>a::Float64</code>: Intercept for regression calculation</li><li><code>ea::Float64</code>: Error on intercept</li><li><code>m0::Float64</code>: dt/t for current correlation with no intercept</li><li><code>em0::Float64</code>: Error for calulatoin of <code>m0</code></li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/tclements/SeisNoise.jl/blob/de310856964e0c472c21c2e5fa0e5956bce295b9/src/VelocityChange/MWCS.jl#L171-L212">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SeisNoise.stretching" href="#SeisNoise.stretching"><code>SeisNoise.stretching</code></a> — <span class="docstring-category">Function</span>.</div><div><div><p>stretching(ref,cur,t,window,fmin,fmax;dvmin,dvmax,ntrials)</p><p>This function compares the Reference waveform to stretched/compressed current waveforms to get the relative seismic velocity variation (and associated error). It also computes the correlation coefficient between the Reference waveform and the current waveform.</p><p><strong>Arguments</strong></p><ul><li><code>ref::AbstractArray</code>: Reference correlation.</li><li><code>cur::AbstractArray</code>: Current correlation.</li><li><code>t::AbstractArray</code>: time vector, common to both <code>ref</code> and <code>cur</code>.</li><li><code>window::AbstractArray</code>: vector of the indices of the <code>cur</code> and <code>ref</code> windows                         on which you want to do the measurements</li><li><code>fmin::Float64</code>: minimum frequency in the correlation [Hz]</li><li><code>fmax::Float64</code>: maximum frequency in the correlation [Hz]</li><li><code>dvmin::Float64</code>: minimum bound for the velocity variation; e.g. dvmin=-0.03                  for -3% of relative velocity change</li><li><code>dvmax::Float64</code>: maximum bound for the velocity variation; e.g. dvmin=0.03                 for 3% of relative velocity change</li><li><code>ntrial::Int</code>:  number of stretching coefficient between dvmin and dvmax, no need to be higher than 100</li></ul><p><strong>Returns</strong></p><ul><li><code>dv::AFloat64</code>: Relative Velocity Change dv/v (in %)</li><li><code>cc::Float64</code>: Correlation coefficient between the reference waveform and the                     best stretched/compressed current waveform</li><li><code>cdp::Float64</code>: Correlation coefficient between the reference waveform and the                initial current waveform</li><li><code>ϵ::Array{Float64,1}</code>: Vector of Epsilon values (ϵ =-dt/t = dv/v)</li><li><code>err::Float64</code>: Errors in the dv/v measurements based on <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/j.1365-246X.2011.05015.x">Weaver et al., 2011</a></li><li><code>allC::Array{Float64,1}</code>: Vector of the correlation coefficient between the                       reference waveform and every stretched/compressed                       current waveforms</li></ul><p>This code is a Julia translation of the Python code from <a href="https://github.com/lviens/2018_JGR">Viens et al., 2018</a>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tclements/SeisNoise.jl/blob/de310856964e0c472c21c2e5fa0e5956bce295b9/src/VelocityChange/Stretching.jl#L3-L39">source</a><div><div><p>stretching(C,t,window,fmin,fmax;dvmin,dvmax,ntrials)</p><p>This function compares the Reference waveform to stretched/compressed current waveforms to get the relative seismic velocity variation (and associated error) for all correlations in CorrData <code>C</code>. It also computes the correlation coefficient between the Reference waveform and the current waveform.</p><p><strong>Arguments</strong></p><ul><li><code>C::CorrData</code>: Correlation for dv/v.</li><li><code>cur::AbstractArray</code>: Current correlation.</li><li><code>t::AbstractArray</code>: time vector, common to both <code>ref</code> and <code>cur</code>.</li><li><code>window::AbstractArray</code>: vector of the indices of the <code>cur</code> and <code>ref</code> windows                         on which you want to do the measurements</li><li><code>fmin::Float64</code>: minimum frequency in the correlation [Hz]</li><li><code>fmax::Float64</code>: maximum frequency in the correlation [Hz]</li><li><code>dvmin::Float64</code>: minimum bound for the velocity variation; e.g. dvmin=-0.03                  for -3% of relative velocity change</li><li><code>dvmax::Float64</code>: maximum bound for the velocity variation; e.g. dvmin=0.03                 for 3% of relative velocity change</li><li><code>ntrial::Int</code>:  number of stretching coefficient between dvmin and dvmax, no need to be higher than 100</li></ul><p><strong>Returns</strong></p><ul><li><code>dv::Array{Float64,1}</code>: Relative Velocity Change dv/v (in %)</li><li><code>cc::Array{Float64,1}</code>: Correlation coefficient between the reference waveform and the                     best stretched/compressed current waveform</li><li><code>cdp::Array{Float64,1}</code>: Correlation coefficient between the reference waveform and the                initial current waveform</li><li><code>ϵ::Array{Float64,1}</code>: Vector of Epsilon values (ϵ =-dt/t = dv/v)</li><li><code>err::Array{Float64,1}</code>: Errors in the dv/v measurements based on <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/j.1365-246X.2011.05015.x">Weaver et al., 2011</a></li><li><code>allC::Array{Float64,2}</code>: Matrix of the correlation coefficient between the                       reference waveform and every stretched/compressed                       current waveforms</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/tclements/SeisNoise.jl/blob/de310856964e0c472c21c2e5fa0e5956bce295b9/src/VelocityChange/Stretching.jl#L89-L123">source</a></section><footer><hr/><a class="previous" href="../correlation/"><span class="direction">Previous</span><span class="title">Correlation</span></a></footer></article></body></html>
