<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Pre-Processing · SeisNoise.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../index.html"><img class="logo" src="../assets/logo.png" alt="SeisNoise.jl logo"/></a><h1>SeisNoise.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><span class="toctext">Types</span><ul><li><a class="toctext" href="../Types/fftdata/">FFTData</a></li><li><a class="toctext" href="../Types/corrdata/">CorrData</a></li></ul></li><li class="current"><a class="toctext" href>Pre-Processing</a><ul class="internal"><li><a class="toctext" href="#Load-or-download-data-1">Load or download data</a></li><li><a class="toctext" href="#Merge-and-ungap-data-1">Merge and ungap data</a></li><li><a class="toctext" href="#Downsample-Data-1">Downsample Data</a></li><li><a class="toctext" href="#Creating-Sliding-Windows-1">Creating Sliding Windows</a></li><li><a class="toctext" href="#Detrending-and-Demeaning-1">Detrending and Demeaning</a></li><li><a class="toctext" href="#Pre-Processing-Functions-1">Pre-Processing Functions</a></li></ul></li><li><a class="toctext" href="../filter/">Filtering</a></li><li><a class="toctext" href="../fft/">Computing FFTs</a></li><li><a class="toctext" href="../correlation/">Correlation</a></li><li><a class="toctext" href="../postprocessing/">Velocity Change</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Pre-Processing</a></li></ul><a class="edit-page" href="https://github.com/tclements/SeisNoise.jl/blob/master/docs/src/preprocessing.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Pre-Processing</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Pre-Processing-methods-for-cleaning-raw-noise-data.-1" href="#Pre-Processing-methods-for-cleaning-raw-noise-data.-1"><code>Pre-Processing</code> - methods for cleaning raw noise data.</a></h1><p>The pre-processing functions get raw data ready for correlation. Many of these rely on <a href="https://seisio.readthedocs.io/en/latest/src/Processing/processing.html">SeisIO&#39;s processing</a>. A typical workflow includes the following steps:</p><ul><li>Loading data</li><li>Filling gaps</li><li>Downsampling</li><li>Slicing day-long traces into smaller windows</li><li>Demeaning, detrending and tapering</li></ul><p>Here is an example workflow:</p><h2><a class="nav-anchor" id="Load-or-download-data-1" href="#Load-or-download-data-1">Load or download data</a></h2><p>Data can be downloaded using <code>SeisIO</code>&#39;s <code>get_data</code> function.</p><pre><code class="language-julia">julia&gt; using SeisIO, SeisNoise
julia&gt; S = get_data(&quot;IRIS&quot;,&quot;TA.V04C..BHZ&quot;,s=&quot;2006-02-01&quot;,t=&quot;2006-02-02&quot;)
SeisData with 1 channels (1 shown)
    ID: TA.V04C..BHZ                       
  NAME: TA.V04C..BHZ                       
   LOC: 0.0 N, 0.0 E, 0.0 m                
    FS: 40.0                               
  GAIN: 1.0                                
  RESP: c = 0.0, 0 zeros, 0 poles          
 UNITS:                                    
   SRC:                                    
  MISC: 0 entries                          
 NOTES: 0 entries                          
     T: 2006-02-01T00:00:00.020 (0 gaps)   
     X: +1.044e-06                         
        +1.060e-06                         
            ...                            
        +6.282e-07                         
        (nx = 3456000)                     
     C: 0 open, 0 total
julia&gt; writesac(S)</code></pre><p>Data can be read from disk using the <code>read_data</code> function .</p><pre><code class="language-julia">julia&gt; S = read_data(&quot;sac&quot;,&quot;2006.032.00.00.00.002.TA.V04C..BHZ.R.SAC&quot;)
SeisData with 1 channels (1 shown)
    ID: TA.V04C..BHZ                       
  NAME:                                    
   LOC: 0.0 N, 0.0 E, 0.0 m                
    FS: 40.0                               
  GAIN: 1.0                                
  RESP: c = 0.0, 0 zeros, 0 poles          
 UNITS:                                    
   SRC: 2006.032.00.00.00.002.TA.V04C..BH…
  MISC: 0 entries                          
 NOTES: 1 entries                          
     T: 2006-02-01T00:00:00.002 (0 gaps)   
     X: +1.044e-06                         
        +1.060e-06                         
            ...                            
        +6.282e-07                         
        (nx = 3456000)                     
     C: 0 open, 0 total</code></pre><h2><a class="nav-anchor" id="Merge-and-ungap-data-1" href="#Merge-and-ungap-data-1">Merge and ungap data</a></h2><p>Use the <code>merge!</code> method to merge <code>S</code> to have one channel. The <code>ungap</code> method replaces gaps in <code>S[1].x</code> with the mean of <code>S[1].x</code>.</p><pre><code class="language-julia">julia&gt; merge!(S)
julia&gt; ungap!(S)</code></pre><h2><a class="nav-anchor" id="Downsample-Data-1" href="#Downsample-Data-1">Downsample Data</a></h2><p>Downsample <code>S</code> to 20 Hz using <code>process_raw!</code>. <code>process_raw!</code>:</p><ul><li>Removes mean from each channel in <code>S</code>.</li><li>Detrends each channel in <code>S</code>.</li><li>Downsamples data to sampling rate <code>fs</code></li><li>Phase-shifts data to begin at 00:00:00.0<ul><li>This is important for data that does not begin exactly on the sampling rate, e.g. the starttime is 2006-02-01T00:00:00.020.  </li></ul></li></ul><pre><code class="language-julia">julia&gt; process_raw!(S,20.)
julia&gt; S
SeisData with 1 channels (1 shown)
    ID: TA.V04C..BHZ                       
  NAME: TA.V04C..BHZ                       
   LOC: 0.0 N, 0.0 E, 0.0 m                
    FS: 20.0                               
  GAIN: 1.0                                
  RESP: c = 0.0, 0 zeros, 0 poles          
 UNITS:                                    
   SRC:                                    
  MISC: 0 entries                          
 NOTES: 1 entries                          
     T: 2006-02-01T00:00:00.000 (0 gaps)   
     X: +9.289e-10                         
        -9.248e-10                         
            ...                            
        -9.287e-10                         
        (nx = 1728000)                     
     C: 0 open, 0 total</code></pre><p>Note that now <code>S</code> has sampling rate <code>fs = 20.0</code>, has half as many points (<code>nx = 1728001</code>) as before and the starttime has changed to 2006-02-01T00:00:00.000.</p><h2><a class="nav-anchor" id="Creating-Sliding-Windows-1" href="#Creating-Sliding-Windows-1">Creating Sliding Windows</a></h2><p><a href="https://onlinelibrary.wiley.com/doi/full/10.1111/j.1365-246X.2011.05263.x">Seats et al., 2011</a> showed that short term stacks of cross-correlations converge more quickly when dividing raw data into short, overlapping windows. The <code>slide</code> function splits <code>S</code> into windows of length <code>cc_len</code> (in seconds), with step between windows <code>cc_step</code> (in seconds).</p><pre><code class="language-julia">julia&gt; cc_step, cc_len = 450, 1800 # 30 minute window length with 75% overlap
julia&gt; A, starts, ends = slide(S[1], cc_len, cc_step)
julia&gt; A
36000×189 Array{Float64,2}:
    0.0          -103.095  -67.9792   35.5011   -109.735   …   290.23     18.2172    2827.49    -8198.7      
    3.14758e-6   -105.382  -69.2759   29.9752   -105.452       483.704    80.7089   -2596.52    -9547.97     
    0.000105115  -104.929  -71.0974   24.1595   -104.596       635.558     9.51002  -1728.5     -7885.31     
    0.000551506  -104.545  -73.0085   16.088    -100.576      1193.93     30.3235   -4105.61    -3688.67     
    0.00155024   -104.646  -75.5247    6.76857   -95.9664     1181.32    -13.5895    1410.62      -65.8756   
    ⋮                                                      ⋱     ⋮                                           
 -104.322        -105.706  -54.9128  -65.9102     51.2037  …   733.128  -422.694      -76.919      -5.99003  
 -106.025        -106.238  -63.692   -44.0787     46.1554      155.186  -378.362      -63.3664     -1.61041  
 -108.454        -106.888  -70.0719  -26.3757     42.7611     -367.41   -310.284     -142.125       0.503033
 -113.258        -104.777  -79.5973  -20.8923     38.9552      180.431  -272.636     -137.636       0.167523
 -113.7          -103.16   -85.4747   -7.70531    36.072       472.996  -293.358      -74.2375     -0.0133164</code></pre><p>Now <code>A</code> is a 2d Array containing 189 sliding windows, each 1800 seconds long.</p><h2><a class="nav-anchor" id="Detrending-and-Demeaning-1" href="#Detrending-and-Demeaning-1">Detrending and Demeaning</a></h2><p>The <code>demean</code> and <code>detrend</code> functions are applied column wise.</p><pre><code class="language-julia">julia&gt; A = reshape(collect(1.:10.),5,2)
5×2 Array{Float64,2}:
 1.0   6.0
 2.0   7.0
 3.0   8.0
 4.0   9.0
 5.0  10.0
julia&gt; demean(A)
5×2 Array{Float64,2}:
 -2.0  -2.0
 -1.0  -1.0
  0.0   0.0
  1.0   1.0
  2.0   2.0
julia&gt; detrend(A)
5×2 Array{Float64,2}:
6.66134e-16  3.55271e-15
1.33227e-15  5.32907e-15
2.22045e-15  7.10543e-15
2.66454e-15  7.10543e-15
3.55271e-15  1.06581e-14</code></pre><h2><a class="nav-anchor" id="Pre-Processing-Functions-1" href="#Pre-Processing-Functions-1">Pre-Processing Functions</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SeisNoise.process_raw!" href="#SeisNoise.process_raw!"><code>SeisNoise.process_raw!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">process_raw!(S,fs)</code></pre><p>Pre-process raw seismic data.</p><ul><li>Removes mean from each channel in <code>S</code>.</li><li>Detrends each channel in <code>S</code>.</li><li>Downsamples data to sampling rate <code>fs</code></li><li>Phase-shifts data to begin at 00:00:00.0</li></ul><p><strong>Arguments</strong></p><ul><li><code>S::SeisData</code>: SeisData structure.</li><li><code>fs::Float64</code>: Sampling rate to downsample <code>S</code>.</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/tclements/SeisNoise.jl/blob/8692797d0b84ca842cbc3ecf17645545069ac0ca/src/compute_fft.jl#L58-L71">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SeisNoise.downsample" href="#SeisNoise.downsample"><code>SeisNoise.downsample</code></a> — <span class="docstring-category">Function</span>.</div><div><div><p>downsample(C::SeisChannel,fs::Real)</p><p>Downsample SeisChannel sampling rate to frequency <code>fs</code>.</p><p>For best results, lowpass filter data to <code>fs</code> before downsampling. Implements the weighted average slopes interpolation scheme proposed in [Wiggins1976] for evenly sampled data from obspy.signal.interpolation.weighted<em>average</em>slopes.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tclements/SeisNoise.jl/blob/8692797d0b84ca842cbc3ecf17645545069ac0ca/src/downsample.jl#L3-L13">source</a><div><div><pre><code class="language-none">downsample(S::SeisData, fs::Float64)</code></pre><p>Downsample SeisData sampling rate to frequency <code>fs</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tclements/SeisNoise.jl/blob/8692797d0b84ca842cbc3ecf17645545069ac0ca/src/downsample.jl#L37-L41">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SeisNoise.slide" href="#SeisNoise.slide"><code>SeisNoise.slide</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">slide(C::SeisChannel, cc_len::Int, cc_step::Int)</code></pre><p>Cut <code>C</code> into equal length sliding windows.</p><p><strong>Arguments</strong></p><ul><li><code>C::SeisChannel</code>: SeisChannel.</li><li><code>cc_len::Int</code>: Cross-correlation window length [s].</li><li><code>cc_step::Int</code>: Step between cross-correlation windows [s].</li></ul><p><strong>Returns</strong></p><ul><li><code>A::Array</code>: Array of sliding windows</li><li><code>starts::Array</code>: Array of start times of each window, in Unix time. E.g to convert       Unix time to date time, use u2d(starts[1]) = 2018-08-12T00:00:00</li><li><code>ends::Array</code>: Array of end times of each window, in Unix time.</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/tclements/SeisNoise.jl/blob/8692797d0b84ca842cbc3ecf17645545069ac0ca/src/slicing.jl#L37-L52">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SeisNoise.detrend!" href="#SeisNoise.detrend!"><code>SeisNoise.detrend!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">detrend!(X::AbstractArray{&lt;:Union{Float32,Float64},1})</code></pre><p>Remove linear trend from array <code>X</code> using least-squares regression.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tclements/SeisNoise.jl/blob/8692797d0b84ca842cbc3ecf17645545069ac0ca/src/ArrayFuncs.jl#L5-L9">source</a><div><div><pre><code class="language-none">detrend!(X::AbstractArray{&lt;:Union{Float32,Float64},2})</code></pre><p>Remove linear trend from columns of <code>X</code> using least-squares regression.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tclements/SeisNoise.jl/blob/8692797d0b84ca842cbc3ecf17645545069ac0ca/src/ArrayFuncs.jl#L21-L25">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="SeisNoise.demean!" href="#SeisNoise.demean!"><code>SeisNoise.demean!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">demean!(A::AbstractArray{&lt;:Union{Float32,Float64},1})</code></pre><p>Remove mean from array <code>A</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tclements/SeisNoise.jl/blob/8692797d0b84ca842cbc3ecf17645545069ac0ca/src/ArrayFuncs.jl#L43-L47">source</a><div><div><p>demean!(A::AbstractArray{&lt;:Union{Float32,Float64},2})</p><p>Remove mean from columns of array <code>A</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tclements/SeisNoise.jl/blob/8692797d0b84ca842cbc3ecf17645545069ac0ca/src/ArrayFuncs.jl#L58-L62">source</a></section><footer><hr/><a class="previous" href="../Types/corrdata/"><span class="direction">Previous</span><span class="title">CorrData</span></a><a class="next" href="../filter/"><span class="direction">Next</span><span class="title">Filtering</span></a></footer></article></body></html>
